---
title: "Data Science Lab - Assignment 1"
author: "Marco Distrutti"
date: "8 Maggio 2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup,Include=FALSE}
library(magrittr)  # package for concatenating commands %>%
library(tibble)    # set data as tibble object
library(dplyr)     # data management (filter,select,summarize,ecc...)
library(lubridate) # manipulating dates
library(tidyr)
library(ggplot2)
library(pander)

```

```{r}
#
# Fetch ISTAT csv files:
# Merge daily death toll from the most updated data (comuni_giornaliero.csv) with extra data such as data_inizio_diff (comune_giorno.csv)
#

wd="C:\\Users\\loren\\Desktop\\repos_github\\Covid19_prediction\\data"

setwd(wd)

#readind .csv files
file_path = c("deaths.lombardy.csv","deaths.global.csv","Tabella_45 Comuni subentrati.csv","Popolazione_comuni_italiani.csv")
dt_lomb=read.csv(file_path[1])
dt_global =read.csv(file_path[2])
dt_ANPR = read.csv(file_path[3],sep=';')
dt_population=read.csv(file_path[4],sep = ';')
#sorting dates (variable GE)
dt_lomb=dt_lomb%>%arrange(GE)
dt_global=dt_global%>%arrange(GE)


```


```{r}
dt_population=dt_population%>%select(c("Ã¯..ITTER107",'Territorio','Sesso','Value'))
```

$ITTER107$ field

NUTS stands for "Nomenclature of Territorial Units for Statistics" which is is a geocode standard for referencing the subdivisions of countries for statistical purposes. The following link refers to a complete list of all territorial units codes :

https://www.istat.it/it/archivio/6789


Notice that all the values of the ITTER107 field has a prefixed 0
For instance : 
ITTER107= <0>12017 corresponds to COD_PROVCOM = 12017  =>  Brebbia (Varese, Lombardy)

Therefore, a good option would be to remove that prefix and then join the 2 tables 

```{r}

#in order to make the left join the variables (keys) must be of the same type. Let's transform them into characters and then execute theleft join with right key = cod_nuts and left key = COD_PROVCOM

names(dt_population)[1]='cod_nuts'
dt_population$cod_nuts=dt_population$cod_nuts%>%as.character()
dt_lomb$COD_PROVCOM=dt_lomb$COD_PROVCOM%>%as.character()

#reshaping dt_population in the form #cod_nuts,territorio,femmine,maschi,totale

dt_population=dt_population%>%spread(Sesso,Value)
dt_population_joined=left_join(dt_lomb,dt_population,by=c('COD_PROVCOM'='cod_nuts'))
```


```{r}

```

```{r}
setwd(wd)
write.csv(dt_population_joined,'dt_analysis.csv' )

```

